<!doctype html>
<html lang="en" class="has-navbar-fixed-top">

<head>
  <title>OpenAPI-GUI v3.0.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf8">
  <link href="css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/github.min.css">
  <link href="css/buefy.min.css" rel="stylesheet">
  <link href="css/balloon.min.css" rel="stylesheet">
  <link href="css/jsoneditor.min.css" rel="stylesheet" type="text/css">
  <link href="css/app.css" rel="stylesheet">

  <script type='text/javascript' src='js/zepto.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.5/clipboard.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
  <script type='text/javascript' src="js/js-yaml.min.js"></script>
  <script type='text/javascript' src="js/jsonpatch.js"></script>
  <script type='text/javascript' src="js/jsoneditor.min.js"></script>
  <script type='text/javascript' src="data/static.js"></script>
  <!-- <script type='text/javascript' src="js/vue.min.js"></script> -->
  <script type='text/javascript' src='https://vuejs.org/js/vue.js'></script>
  <script type='text/javascript' src="js/vuelidate.min.js"></script>
  <script type='text/javascript' src="js/validators.min.js"></script>
  <script type='text/javascript' src="js/buefy.min.js"></script>
  <script type='text/javascript' src="js/markdown-it.min.js"></script>

  <script src="src/resource/resource.js"></script>
  <script src="src/method/method.js"></script>
  <script src="src/parameter/parameter.js"></script>
  <script src="src/items/items.js"></script>
  <script src="src/extension/extension.js"></script>
  <script src="src/app/gui.js"></script>

  <script src="src/api-definition/api-definition.js"></script>
  <script src="src/api-yaml/api-yaml.js"></script>

  <script src="src/app/app.js"></script>

</head>

<body>
  <div id="loading" class="section">
  <div class="container is-fluid">
  <article class="message">
    <div class="message-header">
        <p>Loading</p>
        <button class="delete"></button>
    </div>
    <div class="message-body">
      <strong>Please wait!</strong> OpenAPI-GUI v3 is loading... <progress id="progress" class="progress is-success" value="0" max="100">0 %</progress>
      <p>In case OpenAPI-GUI does not start, please use the <a href="/rescue.html">rescue utility</a> or check the console.</p>
    </div>
  </article>
  </div>
  </div>

  <div id="main-container">
    <gui-main :openapi='container.openapi' :importschema='importschema' :settings='settings'></gui-main>
  </div>
  <script>
      var def = [];
      var cgData = {
        clients : [],
        servers : []
      };

      $(document).ready(function(){

        $.ajax({
            url: 'http://generator.swagger.io/api/gen/clients',
            success: function(data) {
                cgData.clients = data;
            }
        });
        $.ajax({
            url: 'http://generator.swagger.io/api/gen/servers',
            success: function(data) {
                cgData.servers = data;
            }
        });

        function loadIt(targetId,url) {
            var p = new Promise(function(resolve,reject){
                $(targetId).load(url, function(data, status, xhr) {
                    $('#progress').attr('value', parseInt($('#progress').attr('value'))+(100/def.length));
                    if (xhr.getResponseHeader('X-OpenAPI-GUI')) {
                        window.intelligentBackend = true;
                    }
                    resolve(data);
                });
            });
            def.push(p);
            return p;
        }

        function loadDefinition(url) {
            return new Promise(function(resolve,reject){
                var resolveNow = true;
                $.ajax({
                    url: url,
                    success: function(data) {
                        try {
                            if (typeof data === 'string') {
                                data = jsyaml.safeLoad(data);
                            }
                            if (data.swagger && (data.swagger === '2.0')) {
                                resolveNow = false;
                                convertOpenApi2(data,function(schema){
                                    openapi = preProcessDefinition(schema);
                                    resolve();
                                });
                            }
                            else {
                                openapi = preProcessDefinition(data);
                            }
                        }
                        catch (ex) {
                            alert(ex);
                        }
                    },
                    error: function(xhr, type) {
                        console.log('error',type);
                        reject(type);
                    },
                    complete: function() {
                        if (resolveNow) resolve();
                    }
                });
            });
        }

        loadIt('#template-gui-main','src/app/gui.html');
        loadIt('#template-resource','src/resource/resource.html');
        loadIt('#template-method','src/method/method.html');
        loadIt('#template-parameter','src/parameter/parameter.html');
        loadIt('#template-definition','src/api-definition/output.html');
        loadIt('#template-yaml','src/api-yaml/output.html');
        loadIt('#template-items','src/items/items.html');
        loadIt('#template-extension','src/extension/extension.html');
        loadIt('#template-property','src/extension/property.html');

        var loadUrl = getUrlParameterByName('url');
        if (loadUrl) {
           def.push(loadDefinition(loadUrl));
        }
 
        // when all promises have been resolved...
        Promise.all(def).then(function() {
          if (screen && screen.orientation) {
              try {
                screen.orientation.lock('landscape');
              }
              catch (ex) {};
          }
          $(function() { $.support.transition = false; });
          app_main();
          $('#loading').addClass('hidden');
        });

      });
  </script>
  <div class="hidden">
    <div id="template-gui-main"></div>
    <div id="template-resource"></div>
    <div id="template-method"></div>
    <div id="template-parameter"></div>
    <div id="template-definition"></div>
    <div id="template-yaml"></div>
    <div id="template-items"></div>
    <div id="template-extension"></div>
    <div id="template-property"></div>
  </div>
  <div class="modal fade" id="schemaModal">
    <div class="card">
      <div class="card-header">
        <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
        <h3 class="title">Schema Editor</h3>
      </div>
      <div class="card-content">
        <div id="schemaContainer">
        </div>
      </div>
      <div class="card-footer">
        <p class="card-footer-item">
          <a href="#" class="button is-warning" onclick="schemaEditorClose()">Close</a>
        </p>
        <p class="card-footer-item">
          <a href="#" class="button is-primary" onclick="schemaEditorSave()">Save changes</a>
        </p>
      </div>
    </div>
  </div>
</body>

</html>

